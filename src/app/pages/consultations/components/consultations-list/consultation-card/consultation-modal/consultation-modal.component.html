<cons-modal-window [isOpen]="isOpen" [modalRef]="modalRef" (close)="onClose()">
  <div class="modal-container" (click)="onModalClick($event)">
    <div class="modal-header">
      <h3 class="modal-title">Book Consultation</h3>
      <button type="button" class="modal-close-btn" (click)="onClose()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="modal-body">
      <div class="consultation-info" *ngIf="model">
        <h4>{{ model.title }}</h4>
        <div class="coach-info" *ngIf="model.coach">
          <span class="coach-name">{{ coachFullName }}</span>
          <span class="coach-position">{{ model.coach.position }}</span>
        </div>
        <div class="consultation-meta">
          <span *ngIf="model.duration">Duration: {{ model.duration }}</span>
          <span *ngIf="model.price">Price: {{ model.price }}</span>
        </div>
      </div>

      <form [formGroup]="consultationForm" (ngSubmit)="onSubmit()" *ngIf="consultationForm">
        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" formControlName="email" placeholder="your@email.com">
          <div class="error" *ngIf="isFieldInvalid('email')">
            {{ getFieldError('email') }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="date">Date *</label>
            <input type="date" id="date" formControlName="date">
            <div class="error" *ngIf="isFieldInvalid('date')">
              Date is required
            </div>
          </div>

          <div class="form-group">
            <label for="time">Time *</label>
            <input type="time" id="time" formControlName="time">
            <div class="error" *ngIf="isFieldInvalid('time')">
              Time is required
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="phone">Phone</label>
          <div>
            <mat-select></mat-select>
            <input type="tel" id="phone" formControlName="phone" placeholder="+1 (555) 123-4567">
          </div>
        </div>

        <div class="form-group">
          <label for="topics">Topics</label>
          <mat-chip-listbox class="topics-chips" [multiple]="true">
            <mat-chip-option *ngFor="let competency of competenciesList" [value]="competency">
              {{ competency }}
            </mat-chip-option>
          </mat-chip-listbox>
        </div>

        <div class="form-group">
          <label for="message">Message</label>
          <textarea id="message" rows="3" placeholder="Tell us about your goals..."></textarea>
          <!-- formControlName="message"-->
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="onClose()" [disabled]="isLoading">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="consultationForm.invalid || isLoading"
            (click)="sendRequest()"  
          >
            <span *ngIf="!isLoading">Book Consultation</span>
            <span *ngIf="isLoading">Loading...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</cons-modal-window>